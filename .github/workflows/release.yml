name: Release Obsidian plugin

on:
  push:
    tags:
      - "*"

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v3

      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18.x"

      - name: Build plugin
        run: |
          npm install
          npm run build

      - name: Create release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          tag="${GITHUB_REF#refs/tags/}"
          
          gh release create "$tag" \
            --title="$tag - Performance Optimization & AI UX Improvements" \
            --notes="$(cat <<'EOF'
## ðŸš€ Performance Enhancements (Phase 1)
- **AI Module Lazy Loading**: Faster initial startup by loading AI components only when needed
- **Code Splitting**: AI_PROMPTS separated for better tree shaking optimization  
- **Smart Logging**: Environment-based logging levels for production efficiency

## ðŸŽ¨ AI Button UX Improvements
- **Clear Visual Feedback**: Immediate recognition when AI services are disabled
- **Helpful Tooltips**: Detailed guidance on how to configure AI settings
- **Consistent State Management**: Reliable button states across all scenarios

## ðŸ“Š Bundle Analysis
- **main.js**: 355KB (optimized with lazy loading infrastructure)
- **styles.css**: 35KB (enhanced AI styling and responsive design)
- **Code Quality**: 12,895 lines with performance optimization framework

## ðŸ”§ Technical Improvements
- **Full Async Compatibility**: Enhanced AI service integration with proper async/await patterns
- **Memory Optimization**: Reduced memory footprint in production environments
- **CSS Modularization**: Better maintainability and theming support

## âœ¨ User Experience
- **Immediate AI Status Recognition**: Users can instantly see if AI features are available
- **Configuration Guidance**: Clear instructions for setting up AI providers
- **Consistent Interface**: Uniform behavior across desktop and mobile devices

This release focuses on performance optimization while maintaining feature completeness and significantly improving user experience around AI functionality.
EOF
)" \
            --draft \
            main.js manifest.json styles.css